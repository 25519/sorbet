<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Final Methods, Classes, and Modules · Sorbet</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Sorbet supports final methods, classes, and modules.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Final Methods, Classes, and Modules · Sorbet"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sorbet.org/"/><meta property="og:description" content="&lt;p&gt;Sorbet supports final methods, classes, and modules.&lt;/p&gt;
"/><meta property="og:image" content="https://sorbet.org/img/sorbet-logo-card@2x.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://sorbet.org/img/sorbet-logo-card@2x.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://sorbet.org/blog/atom.xml" title="Sorbet Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://sorbet.org/blog/feed.xml" title="Sorbet Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-119877071-2', 'auto');
              ga('send', 'pageview');
            </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/sorbet-logo-white-sparkles.svg" alt="Sorbet"/><h2 class="headerTitleWithLogo">Sorbet</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/adopting" target="_self">Get started</a></li><li class="siteNavGroupActive"><a href="/docs/overview" target="_self">Docs</a></li><li class=""><a href="https://sorbet.run" target="_self">Try</a></li><li class=""><a href="/en/community" target="_self">Community</a></li><li class=""><a href="https://github.com/sorbet/sorbet" target="_self">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Type System</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/adopting">Adopting Sorbet</a></li><li class="navListItem"><a class="navItem" href="/docs/quickref">Quick Reference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Static &amp; Runtime</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/gradual">Gradual Type Checking</a></li><li class="navListItem"><a class="navItem" href="/docs/static">Enabling Static Checks</a></li><li class="navListItem"><a class="navItem" href="/docs/runtime">Enabling Runtime Checks</a></li><li class="navListItem"><a class="navItem" href="/docs/rbi">RBI Files</a></li><li class="navListItem"><a class="navItem" href="/docs/cli">Command Line Reference</a></li><li class="navListItem"><a class="navItem" href="/docs/tconfiguration">Runtime Configuration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Troubleshooting</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/troubleshooting">Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/docs/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/error-reference">Error Reference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Type System</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/sigs">Signatures</a></li><li class="navListItem"><a class="navItem" href="/docs/type-annotations">Type Annotations</a></li><li class="navListItem"><a class="navItem" href="/docs/type-assertions">Type Assertions</a></li><li class="navListItem"><a class="navItem" href="/docs/class-types">Class Types</a></li><li class="navListItem"><a class="navItem" href="/docs/nilable-types">Nilable Types</a></li><li class="navListItem"><a class="navItem" href="/docs/union-types">Union Types</a></li><li class="navListItem"><a class="navItem" href="/docs/flow-sensitive">Flow Sensitivity</a></li><li class="navListItem"><a class="navItem" href="/docs/exhaustiveness">Exhaustiveness Checking</a></li><li class="navListItem"><a class="navItem" href="/docs/tuples">Tuples</a></li><li class="navListItem"><a class="navItem" href="/docs/shapes">Shapes</a></li><li class="navListItem"><a class="navItem" href="/docs/tstruct">Typed Structs</a></li><li class="navListItem"><a class="navItem" href="/docs/untyped">T.untyped</a></li><li class="navListItem"><a class="navItem" href="/docs/noreturn">T.noreturn</a></li><li class="navListItem"><a class="navItem" href="/docs/type-aliases">Type Aliases</a></li><li class="navListItem"><a class="navItem" href="/docs/stdlib-generics">Arrays &amp; Hashes</a></li><li class="navListItem"><a class="navItem" href="/docs/procs">Proc Types</a></li><li class="navListItem"><a class="navItem" href="/docs/class-of">T.class_of</a></li><li class="navListItem"><a class="navItem" href="/docs/self-type">T.self_type</a></li><li class="navListItem"><a class="navItem" href="/docs/abstract">Abstract Classes and Interfaces</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/final">Final Methods, Classes, and Modules</a></li><li class="navListItem"><a class="navItem" href="/docs/override-checking">Override Checking</a></li><li class="navListItem"><a class="navItem" href="/docs/intersection-types">Intersection Types</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Experimental Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/metaprogramming-plugins">Metaprogramming plugins</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/sorbet/sorbet/edit/master/website/docs/final.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Final Methods, Classes, and Modules</h1></header><article><div><span><p>Sorbet supports final methods, classes, and modules.</p>
<blockquote>
<p><strong>Note</strong>: Some of the support for final is only implemented using the runtime
system. Support for these checks in the static system is planned for the
future.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="final-methods"></a><a href="#final-methods" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Final methods</h2>
<h3><a class="anchor" aria-hidden="true" id="defining-a-final-method"></a><a href="#defining-a-final-method" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Defining a final method</h3>
<ol>
<li>Call <code>T::Configuration.enable_final_checks_on_hooks</code> at least once.</li>
<li>Add <code>extend T::Sig</code> to the class or module.</li>
<li>Add a sig for the method, with the additional modifier <code>:final</code> passed as an
argument to <code>sig</code>.</li>
<li>Define the method as usual.</li>
</ol>
<pre><code class="hljs css language-ruby">T::Configuration.enable_final_checks_on_hooks

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">HasFinalMethod</span></span>
  extend T::Sig
  sig(<span class="hljs-symbol">:final</span>) {void}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="semantics-of-final-methods"></a><a href="#semantics-of-final-methods" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Semantics of final methods</h3>
<p>Final methods must be defined exactly once on their enclosing module or class.</p>
<pre><code class="hljs css language-ruby">T::Configuration.enable_final_checks_on_hooks

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">HasFinalMethod</span></span>
  extend T::Sig
  sig(<span class="hljs-symbol">:final</span>) {void}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-keyword">end</span> <span class="hljs-comment"># error</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Final methods must not be overridden by any class or module that includes,
extends, or inherits the class or module in which the final method was defined.</p>
<pre><code class="hljs css language-ruby">T::Configuration.enable_final_checks_on_hooks

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">HasFinalMethod</span></span>
  extend T::Sig
  sig(<span class="hljs-symbol">:final</span>) {void}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">BadModule</span></span>
  <span class="hljs-keyword">include</span> HasFinalMethod
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-keyword">end</span> <span class="hljs-comment"># error</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="final-classes-and-modules"></a><a href="#final-classes-and-modules" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Final classes and modules</h2>
<h3><a class="anchor" aria-hidden="true" id="defining-a-final-class-or-module"></a><a href="#defining-a-final-class-or-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Defining a final class or module</h3>
<ol>
<li>Call <code>T::Configuration.enable_final_checks_on_hooks</code> at least once.</li>
<li>Add <code>extend T::Helpers</code> in the body of the class or module.</li>
<li>Call <code>final!</code> in the body of the class or module.</li>
</ol>
<pre><code class="hljs css language-ruby">T::Configuration.enable_final_checks_on_hooks

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">FinalModule</span></span>
  extend T::Helpers
  final!
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FinalClass</span></span>
  extend T::Helpers
  final!
<span class="hljs-keyword">end</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="semantics-of-final-classes-and-modules"></a><a href="#semantics-of-final-classes-and-modules" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Semantics of final classes and modules</h3>
<p>Final classes and modules must not be included, extended, or inherited.</p>
<pre><code class="hljs css language-ruby">T::Configuration.enable_final_checks_on_hooks

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">FinalModule</span></span>
  extend T::Helpers
  final!
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">BadModule</span></span>
  <span class="hljs-keyword">include</span> FinalModule <span class="hljs-comment"># error</span>
  extend FinalModule <span class="hljs-comment"># error</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FinalClass</span></span>
  extend T::Helpers
  final!
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BadClass</span> &lt; FinalClass;</span> <span class="hljs-keyword">end</span> <span class="hljs-comment"># error</span>
</code></pre>
<p>Every method defined in a final class or module must be explicitly declared as
final.</p>
<pre><code class="hljs css language-ruby">T::Configuration.enable_final_checks_on_hooks

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">FinalModule</span></span>
  extend T::Helpers
  final!

  sig(<span class="hljs-symbol">:final</span>) {void}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">good_final_sig</span>;</span> <span class="hljs-keyword">end</span>

  sig {void}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bad_regular_sig</span>;</span> <span class="hljs-keyword">end</span> <span class="hljs-comment"># error</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bad_no_sig</span>;</span> <span class="hljs-keyword">end</span> <span class="hljs-comment"># error</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="final-method-syntax"></a><a href="#final-method-syntax" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Final method syntax</h2>
<p>Note that the syntax for final methods is different from the usual syntax for
declaring things as abstract, override, implementation, etc.</p>
<pre><code class="hljs css language-ruby">sig {abstract.void}
sig {override.void}
sig {implementation.void}
sig(<span class="hljs-symbol">:final</span>) {void}
</code></pre>
<p>The main reason for this difference is that we want to know that a method is
final before running the block inside the sig.</p>
<p>If the syntax for marking a method final was to have a <code>final.</code> builder put
inside the block to sig, similar to <code>abstract.</code>, <code>override.</code>, etc, then, if we
wanted to know whether a method has been marked final or not, then we would need
to run the block in the <code>sig</code>.</p>
<p>The problem is, we would like to know whether a method is final or not in the
runtime &quot;immediately&quot;, i.e. before the method has even been called. This is at
odds with the semantics of the block to <code>sig</code>: the <code>sig</code> block is lazy, and the
code inside it is not run until the first time the method is called.</p>
<p>That is, if we wanted to use a <code>final.</code> builder inside the block to <code>sig.</code>, and
also wanted to know whether a method is final &quot;immediately&quot;, then we would be
forced to run the <code>sig</code> block immediately and not defer it until later. But, if
we were to force the sig block to be run immediately after saying &quot;sig&quot;, then we
would lose the benefits of having the sig block be lazy.</p>
<p>We intentionally want to keep the block to sig lazy, because that means, for
instance, you may reference constants inside the <code>sig</code> block that aren’t yet
defined but will be defined later.</p>
<h2><a class="anchor" aria-hidden="true" id="enabling-all-of-the-runtime-checks"></a><a href="#enabling-all-of-the-runtime-checks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enabling all of the runtime checks</h2>
<p>Before using final in a project, we recommend opting in to all of the runtime
checks.</p>
<p>After requiring <code>sorbet-runtime</code>, but before declaring anything as final, call
<code>T::Configuration.enable_final_checks_on_hooks</code>.</p>
<p>This will install some runtime hooks on <code>Module#included</code>, <code>Module#extended</code>,
and <code>Class#inherited</code>, to allow us to do more runtime checking for correct final
usage.</p>
<p>If these checks are enabled, any classes or modules that define their own
<code>included</code>, <code>extended</code>, or <code>inherited</code> hooks should take care to always call
<code>super</code>.</p>
<p>If these checks are not enabled, then some but not all of the runtime checks for
final will be run. For instance, in the following example, we violate the
requirements of final, but the violation is not a runtime error because we did
not call <code>T::Configuration.enable_final_checks_on_hooks</code>:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">M</span></span>
  extend T::Sig
  sig(<span class="hljs-symbol">:final</span>) {returns(Integer)}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>
  <span class="hljs-keyword">include</span> M
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-number">2</span>; <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

puts C.new.foo
</code></pre>
<p>At runtime, this does not raise and prints 2, showing that we have violated the
guarantees of final. This is why we strongly recommend calling
<code>T::Configuration.enable_final_checks_on_hooks</code> before using final.</p>
<h2><a class="anchor" aria-hidden="true" id="limitations-of-the-statics"></a><a href="#limitations-of-the-statics" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Limitations of the statics</h2>
<p>The following violations of the semantics of “final” are currently not caught by
the static checks (they are only caught by the runtime checks):</p>
<ol>
<li><p>When a method is redefined, as in:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># typed: true</span>
T::Configuration.enable_final_checks_on_hooks

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Bad</span></span>
  extend T::Sig
  sig(<span class="hljs-symbol">:final</span>) {void}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-keyword">end</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre></li>
<li><p>When a method is overridden via including two conflicting modules, as in:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># typed: true</span>
T::Configuration.enable_final_checks_on_hooks

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">A</span></span>
  extend T::Sig
  sig(<span class="hljs-symbol">:final</span>) {void}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">B</span></span>
  extend T::Sig
  sig(<span class="hljs-symbol">:final</span>) {void}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span>;</span> <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Bad</span></span>
  <span class="hljs-keyword">include</span> A
  <span class="hljs-keyword">include</span> B
<span class="hljs-keyword">end</span>
</code></pre></li>
</ol>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/abstract"><span class="arrow-prev">← </span><span>Abstract Classes and Interfaces</span></a><a class="docs-next button" href="/docs/override-checking"><span>Override Checking</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#final-methods">Final methods</a><ul class="toc-headings"><li><a href="#defining-a-final-method">Defining a final method</a></li><li><a href="#semantics-of-final-methods">Semantics of final methods</a></li></ul></li><li><a href="#final-classes-and-modules">Final classes and modules</a><ul class="toc-headings"><li><a href="#defining-a-final-class-or-module">Defining a final class or module</a></li><li><a href="#semantics-of-final-classes-and-modules">Semantics of final classes and modules</a></li></ul></li><li><a href="#final-method-syntax">Final method syntax</a></li><li><a href="#enabling-all-of-the-runtime-checks">Enabling all of the runtime checks</a></li><li><a href="#limitations-of-the-statics">Limitations of the statics</a></li></ul></nav></div><footer class="nav-footer" id="footer"><div class="wrapper"><p class="footer">© 2019 Stripe · <a href="/docs/adopting">Get started</a> · <a href="/docs/overview">Docs</a> · <a href="https://sorbet.run">Try</a> · <a href="/en/community">Community</a> · <a href="/blog">Blog</a> · <a href="https://twitter.com/sorbet_ruby">Twitter</a></p></div></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'fa1ec885ab70787d636759b88e509b92',
                indexName: 'stripe_sorbet',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>